<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.comma_groupware.mapper.EquipmentMapper">

  <!-- 비품 단건 조회 -->
  <select id="selectById" parameterType="int" resultType="com.example.comma_groupware.dto.Equipment">
    SELECT * 
    FROM equipment 
    WHERE equipment_id = #{equipmentId}
  </select>

  <!-- 전체 목록 조회 -->
  <select id="findAll" resultType="com.example.comma_groupware.dto.Equipment">
    SELECT * FROM equipment ORDER BY equipment_id ASC
  </select>

  <!-- 신규 비품 등록 -->
  <insert id="insert" parameterType="com.example.comma_groupware.dto.Equipment" useGeneratedKeys="true" keyProperty="equipmentId">
    INSERT INTO equipment (equipment_name, equipment_desc, stock_quantity)
    VALUES (#{equipmentName}, #{equipmentDesc}, #{stockQuantity})
  </insert>

  <!-- 비품 정보 수정 -->
  <update id="update" parameterType="com.example.comma_groupware.dto.Equipment">
    UPDATE equipment
    SET 
      equipment_name = #{equipmentName},
      equipment_desc = #{equipmentDesc},
      stock_quantity = #{stockQuantity},
      updated_at = NOW()
    WHERE equipment_id = #{equipmentId}
  </update>

  <!-- 재고 차감 -->
  <update id="updateStockAllocate">
    UPDATE equipment
    SET stock_quantity = stock_quantity - #{qty}
    WHERE equipment_id = #{equipmentId} AND stock_quantity >= #{qty}
  </update>

  <!-- 재고 복구 -->
  <update id="updateStockRelease">
    UPDATE equipment
    SET stock_quantity = stock_quantity + #{qty}
    WHERE equipment_id = #{equipmentId}
  </update>

</mapper>
